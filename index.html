<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Î‘Î½Î±Ï†Î¿ÏÎ¬ + Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ (Synced)</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1b33;
      --panel2:#0c172d;
      --line:rgba(255,255,255,.12);
      --text:#e9efff;
      --muted:rgba(233,239,255,.7);
      --accent:#77a6ff;
    }

    html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(180deg,#0a1020,#050913);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      overflow:hidden;
    }

    .topbar{
      height:48px;
      display:flex;
      align-items:center;
      gap:14px;
      padding:0 14px;
      background:rgba(10,16,32,.7);
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(10px);
      font-size:14px;
      color:var(--muted);
    }
    .pill{
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:100px;
      background:rgba(255,255,255,.04);
      color:var(--muted);
    }
    .pill b{color:var(--text)}
    .wrap{
      height:calc(100% - 48px);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:0;
    }

    .col{
      height:100%;
      overflow:auto;
      position:relative;
    }
    .col.left{
      background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
      border-right:1px solid var(--line);
    }
    .col.right{
      background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));
    }

    .inner{
      padding:18px 18px 80px;
      max-width: 980px;
      margin:0 auto;
    }

    /* Reference blocks + marker */
    .refBlock{
      position:relative;           /* <- crucial ÏÏƒÏ„Îµ Î½Î± â€œÎºÎ¬Ï„ÏƒÎµÎ¹â€ Ï„Î¿ marker */
      padding-right:34px;          /* Ï‡ÏÏÎ¿Ï‚ Î³Î¹Î± Ï„Î¿ marker */
      scroll-margin-top: 12px;
    }
    .refMarker{
      position:absolute;
      right:6px;
      top:0;
      z-index:9999;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:24px;
      height:24px;
      border-radius:10px;
      border:1px solid var(--line);
      background:rgba(119,166,255,.14);
      color:var(--text);
      font-size:14px;
      user-select:none;
      cursor:pointer;
      box-shadow:0 8px 20px rgba(0,0,0,.25);
    }
    .refBlock:hover .refMarker{ background:rgba(119,166,255,.22); }
    .refActive{
      outline:2px solid rgba(119,166,255,.45);
      outline-offset: 6px;
      border-radius: 10px;
    }

    /* Notes */
    .noteBlock{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      border-radius:16px;
      padding:12px 12px 12px;
      margin:10px 0;
      scroll-margin-top: 12px;
    }
    .noteHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
      color:var(--muted);
      font-size:13px;
    }
    .noteHead .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .noteHead .chip{
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
    }
    .noteText{
      min-height:72px;
      padding:10px 10px;
      border-radius:12px;
      border:1px dashed rgba(255,255,255,.16);
      background:rgba(0,0,0,.12);
      outline:none;
      color:var(--text);
      line-height:1.45;
    }
    .noteText:focus{
      border-color: rgba(119,166,255,.45);
      box-shadow:0 0 0 3px rgba(119,166,255,.12);
    }

    /* Make reference content look ok inside our shell */
    #refHost{
      background:transparent;
      color:var(--text);
    }
    /* keep images responsive */
    #refHost img{ max-width:100%; height:auto; }

    /* small helper */
    .hint{
      color:var(--muted);
      font-size:13px;
      margin:0 0 12px;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <span class="pill">Î‘ÏÎ¹ÏƒÏ„ÎµÏÎ¬: <b>Reference</b></span>
    <span class="pill">Î”ÎµÎ¾Î¹Î¬: <b>Notes</b></span>
    <span class="pill">Markers: <b id="count">0</b></span>
    <span class="pill">Tip: click <b>ğŸ”–</b> Î³Î¹Î± jump/Î´Î­ÏƒÎ¹Î¼Î¿</span>
  </div>

  <div class="wrap">
    <div class="col left" id="refCol">
      <div class="inner">
        <div class="hint">Î— Î±Î½Î±Ï†Î¿ÏÎ¬ Ï†Î¿ÏÏ„ÏÎ½ÎµÏ„Î±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¬ Î±Ï€ÏŒ <code>yPhysicsALyceum7.html</code> ÎºÎ±Î¹ Î³Î¯Î½ÎµÏ„Î±Î¹ â€œÏƒÏ€Î¬ÏƒÎ¹Î¼Î¿â€ ÏƒÎµ blocks Î¼Îµ markers (ğŸ”–).</div>
        <div id="refHost"></div>
      </div>
    </div>

    <div class="col right" id="noteCol">
      <div class="inner" id="notesHost">
        <div class="hint">Î“ÏÎ¬Ï†ÎµÎ¹Ï‚ ÎµÎ»ÎµÏÎ¸ÎµÏÎ±. ÎšÎ¬Î¸Îµ block Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬ Î­Ï‡ÎµÎ¹ Î±Î½Ï„Î¯ÏƒÏ„Î¿Î¹Ï‡Î¿ note Î´ÎµÎ¾Î¹Î¬.</div>
      </div>
    </div>
  </div>

<script>
(() => {
  const REF_FILE = "yPhysicsALyceum7.html";

  const refCol = document.getElementById("refCol");
  const noteCol = document.getElementById("noteCol");
  const refHost = document.getElementById("refHost");
  const notesHost = document.getElementById("notesHost");
  const countEl = document.getElementById("count");

  const selector = "h1,h2,h3,h4,h5,h6,p,li,blockquote,pre";
  let refBlocks = [];
  let noteBlocks = [];
  let lock = false;

  function setActive(i){
    refBlocks.forEach(el => el.classList.remove("refActive"));
    if(refBlocks[i]) refBlocks[i].classList.add("refActive");
  }

  function scrollToBlock(i){
    if(!refBlocks[i] || !noteBlocks[i]) return;
    lock = true;

    refBlocks[i].scrollIntoView({block:"center", behavior:"smooth"});
    noteBlocks[i].scrollIntoView({block:"center", behavior:"smooth"});
    setActive(i);

    setTimeout(() => { lock = false; }, 350);
  }

  function buildNotes(n){
    // ÎºÎ±Î¸Î¬ÏÎ¹ÏƒÎ¼Î± Ï€Î±Î»Î¹ÏÎ½ (ÎºÏÎ±Ï„Î¬Î¼Îµ Î¼ÏŒÎ½Î¿ Ï„Î¿ hint Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ 1Î¿ child)
    while(notesHost.children.length > 1) notesHost.removeChild(notesHost.lastChild);

    noteBlocks = [];
    for(let i=0;i<n;i++){
      const card = document.createElement("div");
      card.className = "noteBlock";
      card.dataset.rid = String(i);

      const head = document.createElement("div");
      head.className = "noteHead";
      head.innerHTML = `
        <span class="tag">
          <span class="chip">Ref #${i+1}</span>
          <span>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·</span>
        </span>
        <span class="chip">ğŸ”— Synced</span>
      `;

      const text = document.createElement("div");
      text.className = "noteText";
      text.contentEditable = "true";
      text.spellcheck = true;
      text.dataset.rid = String(i);
      text.addEventListener("focus", () => scrollToBlock(i));

      card.appendChild(head);
      card.appendChild(text);
      notesHost.appendChild(card);

      noteBlocks.push(card);
    }
  }

  function attachMarkers(){
    // ÎºÎ±Î¸Î¬ÏÎ¹ÏƒÎµ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î± markers
    refBlocks.forEach(el => {
      const old = el.querySelector(":scope > .refMarker");
      if(old) old.remove();
      el.classList.add("refBlock");
    });

    refBlocks.forEach((el, i) => {
      el.dataset.rid = String(i);

      const m = document.createElement("span");
      m.className = "refMarker";
      m.title = `Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· Î³Î¹Î± Ref #${i+1}`;
      m.textContent = "ğŸ”–";
      m.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        scrollToBlock(i);
        // focus ÏƒÏ„Î¿Î½ editor
        const editor = noteBlocks[i]?.querySelector(".noteText");
        if(editor) editor.focus();
      });

      el.appendChild(m);

      // click whole block -> same behavior (nice)
      el.addEventListener("click", (e) => {
        // Î±Î½ Ï€Î¬Ï„Î·ÏƒÎµ Î®Î´Î· marker, Ï„Î¿ Î±Ï†Î®Î½Î¿Ï…Î¼Îµ
        if(e.target && e.target.classList && e.target.classList.contains("refMarker")) return;
        scrollToBlock(i);
      });
    });

    countEl.textContent = String(refBlocks.length);
  }

  function indexBlocks(){
    // Î¼Î±Î¶ÎµÏÎ¿Ï…Î¼Îµ â€œÎ½Î¿Î·Î¼Î±Ï„Î¹ÎºÎ¬ blocksâ€
    const nodes = Array.from(refHost.querySelectorAll(selector));
    refBlocks = nodes.filter(n => (n.textContent || "").trim().length > 0);

    attachMarkers();
    buildNotes(refBlocks.length);
  }

  async function loadReference(){
    const res = await fetch(REF_FILE, {cache:"no-store"});
    if(!res.ok) throw new Error(`Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ ${REF_FILE} (status ${res.status})`);
    const html = await res.text();

    // parse full html, ÎºÏÎ±Ï„Î¬Î¼Îµ body
    const doc = new DOMParser().parseFromString(html, "text/html");

    // Î¦Î­ÏÎ½Î¿Ï…Î¼Îµ ÎœÎŸÎÎŸ Ï„Î¿ body content Î³Î¹Î± Î½Î± Î¼Î·Î½ â€œÏƒÎºÎ¬ÏƒÎµÎ¹â€ head scripts/styles Ï„Î¿Ï… Î¬Î»Î»Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÎµÎ´Ï.
    // (Î˜ÎµÏ‚ Î±Î½Î±Ï†Î¿ÏÎ¬, ÏŒÏ‡Î¹ Î½Î± Ï„ÏÎ­Ï‡ÎµÎ¹ Ï„Î± Ï€Î¬Î½Ï„Î±.)
    refHost.innerHTML = doc.body ? doc.body.innerHTML : html;

    indexBlocks();
  }

  // Basic 1:1 scroll ratio sync (ÏŒÏ‡Î¹ Ï„Î­Î»ÎµÎ¹Î¿ Î½Î¿Î·Î¼Î±Ï„Î¹ÎºÎ¬, Î±Î»Î»Î¬ ÎºÏÎ±Ï„Î¬ÎµÎ¹ Î¼Î±Î¶Î¯ Ï„Î· ÏÎ¿Î®)
  function syncScroll(from, to){
    if(lock) return;
    const maxFrom = from.scrollHeight - from.clientHeight;
    const maxTo = to.scrollHeight - to.clientHeight;
    if(maxFrom <= 0 || maxTo <= 0) return;
    const ratio = from.scrollTop / maxFrom;
    lock = true;
    to.scrollTop = ratio * maxTo;
    setTimeout(() => { lock = false; }, 0);
  }

  refCol.addEventListener("scroll", () => syncScroll(refCol, noteCol), {passive:true});
  noteCol.addEventListener("scroll", () => syncScroll(noteCol, refCol), {passive:true});

  loadReference().catch(err => {
    refHost.innerHTML = `<div style="padding:14px;border:1px solid rgba(255,255,255,.12);border-radius:14px;background:rgba(255,80,120,.08)">
      <b>Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚:</b> ${String(err.message || err)}
      <div style="margin-top:8px;color:rgba(233,239,255,.7)">
        Î’ÎµÎ²Î±Î¹ÏÏƒÎ¿Ï… ÏŒÏ„Î¹ Ï„Î¿ <code>${REF_FILE}</code> ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î¿Î½ <u>Î¯Î´Î¹Î¿</u> Ï†Î¬ÎºÎµÎ»Î¿ Î¼Îµ Ï„Î¿ <code>index.html</code> ÎºÎ±Î¹ ÏŒÏ„Î¹ Ï„Î¿ Î±Î½Î¿Î¯Î³ÎµÎ¹Ï‚ Î±Ï€ÏŒ server (Ï€.Ï‡. GitHub Pages / VSCode Live Server).
      </div>
    </div>`;
  });

})();
</script>
</body>
</html>
